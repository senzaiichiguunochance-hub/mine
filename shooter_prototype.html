<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>スペースシューター</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #0a0a1a;
            color: #e0e0e0;
            margin: 0;
            overflow: hidden;
        }
        #game-wrapper {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        #game-container {
            display: flex;
            border: 2px solid #00aaff;
            box-shadow: 0 0 20px rgba(0, 170, 255, 0.5);
        }
        canvas {
            background-color: #000;
            display: block; /* Removes bottom margin */
        }
        #info-panel {
            width: 250px;
            padding: 20px;
            background-color: #10102a;
            border-left: 2px solid #00aaff;
            display: flex;
            flex-direction: column;
        }
        h1, h2 {
            color: #00aaff;
            text-align: center;
            margin-top: 0;
            margin-bottom: 20px;
            border-bottom: 1px solid #2a2a4a;
            padding-bottom: 10px;
        }
        .info-box {
            background: #1a1a3a;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        #score-display, #message-display {
            font-size: 1.5em;
            font-weight: bold;
            text-align: center;
        }
        #message-display {
            font-size: 1.2em;
            color: #ff4da6;
            height: 50px;
        }
        ul {
            list-style: none;
            padding: 0;
        }
        ul li {
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        button {
            padding: 12px 20px;
            font-size: 1.2em;
            background-color: #0077cc;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
            width: 100%;
        }
        button:hover {
            background-color: #005fa3;
            box-shadow: 0 0 15px rgba(0, 170, 255, 0.7);
        }
        button:disabled {
            background-color: #555;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div id="game-wrapper">
        <div id="game-container">
            <canvas id="gameCanvas" width="500" height="700"></canvas>
            <div id="info-panel">
                <h1>スペースシューター</h1>
                <div class="info-box">
                    <h2>スコア</h2>
                    <div id="score-display">0</div>
                </div>
                <div class="info-box">
                    <h2>操作方法</h2>
                    <ul>
                        <li><b>← →</b>: 移動</li>
                        <li><b>スペース</b>: 発射</li>
                    </ul>
                </div>
                <div class="info-box">
                    <h2>メッセージ</h2>
                    <div id="message-display"></div>
                </div>
                <button id="startButton">ゲーム開始</button>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreDisplay = document.getElementById('score-display');
        const startButton = document.getElementById('startButton');
        const messageDisplay = document.getElementById('message-display');

        let score = 0;
        let gameRunning = false;
        let animationFrameId;
        let enemies = [];
        let bullets = [];
        let particles = [];
        let lastEnemySpawnTime = 0;
        let shootCooldown = 0;

        const ENEMY_SPAWN_INTERVAL = 800;
        const PLAYER_SHOOT_COOLDOWN = 200; // 弾の発射間隔 (ms)

        // Player
        const player = {
            x: canvas.width / 2 - 25,
            y: canvas.height - 80,
            width: 50,
            height: 60,
            speed: 7,
            draw() {
                ctx.fillStyle = '#00aaff';
                ctx.beginPath();
                ctx.moveTo(this.x + this.width / 2, this.y);
                ctx.lineTo(this.x, this.y + this.height);
                ctx.lineTo(this.x + this.width, this.y + this.height);
                ctx.closePath();
                ctx.fill();
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(this.x + this.width / 2 - 2, this.y + 20, 4, 15);
            },
            shoot() {
                if (shootCooldown <= 0) {
                    bullets.push(new Bullet(this.x + this.width / 2, this.y));
                    shootCooldown = PLAYER_SHOOT_COOLDOWN;
                }
            }
        };

        // Input handling
        const keys = {};
        document.addEventListener('keydown', (e) => { keys[e.key] = true; });
        document.addEventListener('keyup', (e) => { keys[e.key] = false; });

        function handlePlayerInput(deltaTime) {
            if (keys['ArrowLeft'] && player.x > 0) player.x -= player.speed;
            if (keys['ArrowRight'] && player.x < canvas.width - player.width) player.x += player.speed;
            if (keys[' ']) player.shoot();
            if (shootCooldown > 0) shootCooldown -= deltaTime;
        }

        // Bullet
        class Bullet {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.width = 4;
                this.height = 15;
                this.speed = 10;
                this.color = '#ff4da6';
            }
            update() { this.y -= this.speed; }
            draw() {
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x - this.width / 2, this.y, this.width, this.height);
            }
        }

        // Enemy
        class Enemy {
            constructor() {
                this.width = 50;
                this.height = 50;
                this.x = Math.random() * (canvas.width - this.width);
                this.y = -this.height;
                this.speed = Math.random() * 3 + 2;
                this.color = `hsl(${Math.random() * 60 + 200}, 100%, 50%)`; // Shades of blue/purple
            }
            update() { this.y += this.speed; }
            draw() {
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.moveTo(this.x, this.y);
                ctx.lineTo(this.x + this.width, this.y);
                ctx.lineTo(this.x + this.width / 2, this.y + this.height);
                ctx.closePath();
                ctx.fill();
            }
        }

        // Particle for explosions
        class Particle {
            constructor(x, y, color) {
                this.x = x;
                this.y = y;
                this.color = color;
                this.size = Math.random() * 5 + 2;
                this.speedX = Math.random() * 6 - 3;
                this.speedY = Math.random() * 6 - 3;
                this.life = 1000; // 1 second
            }
            update(deltaTime) {
                this.x += this.speedX;
                this.y += this.speedY;
                this.life -= deltaTime;
            }
            draw() {
                ctx.fillStyle = this.color;
                ctx.globalAlpha = this.life / 1000;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.globalAlpha = 1.0;
            }
        }

        function createExplosion(x, y, color) {
            for (let i = 0; i < 20; i++) {
                particles.push(new Particle(x, y, color));
            }
        }

        // Collision detection
        function checkCollision(obj1, obj2) {
            return obj1.x < obj2.x + obj2.width &&
                   obj1.x + obj1.width > obj2.x &&
                   obj1.y < obj2.y + obj2.height &&
                   obj1.y + obj1.height > obj2.y;
        }

        let lastTime = 0;
        function gameLoop(currentTime) {
            if (!gameRunning) return;
            const deltaTime = currentTime - lastTime;
            lastTime = currentTime;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            handlePlayerInput(deltaTime);
            player.draw();

            // Bullets
            bullets = bullets.filter(b => b.y > -b.height);
            bullets.forEach(b => { b.update(); b.draw(); });

            // Enemies
            if (currentTime - lastEnemySpawnTime > ENEMY_SPAWN_INTERVAL) {
                enemies.push(new Enemy());
                lastEnemySpawnTime = currentTime;
            }
            enemies = enemies.filter(e => e.y < canvas.height);
            enemies.forEach(e => { e.update(); e.draw(); });

            // Particles
            particles = particles.filter(p => p.life > 0);
            particles.forEach(p => { p.update(deltaTime); p.draw(); });

            // Collisions
            for (let i = enemies.length - 1; i >= 0; i--) {
                const enemy = enemies[i];
                for (let j = bullets.length - 1; j >= 0; j--) {
                    if (checkCollision(bullets[j], enemy)) {
                        createExplosion(enemy.x + enemy.width / 2, enemy.y + enemy.height / 2, enemy.color);
                        score += 10;
                        scoreDisplay.textContent = score;
                        enemies.splice(i, 1);
                        bullets.splice(j, 1);
                        break;
                    }
                }
                if (checkCollision(player, enemy)) {
                    endGame('ゲームオーバー！');
                    return;
                }
            }

            animationFrameId = requestAnimationFrame(gameLoop);
        }

        function startGame() {
            score = 0;
            scoreDisplay.textContent = score;
            enemies = [];
            bullets = [];
            particles = [];
            gameRunning = true;
            startButton.disabled = true;
            messageDisplay.textContent = '';
            player.x = canvas.width / 2 - player.width / 2;
            lastEnemySpawnTime = performance.now();
            lastTime = performance.now();

            if (animationFrameId) cancelAnimationFrame(animationFrameId);
            animationFrameId = requestAnimationFrame(gameLoop);
        }

        function endGame(message) {
            gameRunning = false;
            startButton.disabled = false;
            messageDisplay.textContent = message;
            if (animationFrameId) cancelAnimationFrame(animationFrameId);
        }

        startButton.addEventListener('click', startGame);
        messageDisplay.textContent = 'ボタンを押して開始';

    </script>
</body>
</html>
